# AWS CDK Github Actions Workshop

In this step, we will setup our nginx stack. It will be a simple stack with a CI to automate its deployment to our AWS account. 
Our stack won't cater for multiple environments yet. 

### CDK Setup
A simple CDK stack has been setup in [nginx directory](./nginx). It is a fairly straightforward stack with an EC2 instance using Amazon Linux 3. It installs and configures an Nginx using [userdata script](./nginx/lib/userdata.sh).

Take a few minutes to understand how the stack has been created as we will be modifying it in the next step to support multiple environments. 

### Github Actions Setup

To deploy our stack, we will setup a CI workflow using Github Actions. A CI workflow has been created under [.github/workflows/deploy.yml](./.github/workflows/deploy.yml).

For this workflow to work, you will need to add the `github-actions-role` ARN to your Github secrets. To do so, go to your repository's Settings > Secrets and Variables > Repository secrets. Create a secret with Name `DEPLOY_ROLE_ARN` and value as your role's ARN. 

>[!NOTE]
New workflows from non-default branches are not recognised by Github unless the same workflow's yaml (even an incomplete one) exists on the default branch. You can see that we set this up in our [Intro branch](https://github.com/karchit/aws-cdk-github-workshop/blob/0-intro/.github/workflows/deploy.yml)

Once you've added the secret, execute your CI Workflow by going to your repository > Actions > "Deploy Nginx Stack to AWS Environment" > Run workflow (on the right) > select this branch > Run workflow. This will kick off a workflow execution and deploy your stack to your AWS environment. 

Take a few minutes to click through each step. The "Deploy Stack" step will output your Nginx Instance's DNS and Private IP. Clicking through to either of the links will spit out an HTML generated by your Nginx instance. 

Be sure to review the deploy workflow if you haven't already. We will also be modifying this to support multiple environments. 

Once you've reviewed the CDK, Workflow code and successfully set up your Nginx instance go ahead to the final step: [3-cdk-multi-env](https://github.com/karchit/aws-cdk-github-workshop/tree/3-cdk-multi-env)
